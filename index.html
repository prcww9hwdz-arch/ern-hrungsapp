<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Ernährungsplan Daniel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Chart.js für Diagramm -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #050509;
      color: #f5f5f5;
    }
    header {
      background: linear-gradient(135deg, #121826, #1f2937);
      padding: 1.2rem 1rem 1rem;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 20;
      border-bottom: 1px solid #111827;
    }
    header h1 {
      margin: 0;
      font-size: 1.3rem;
    }
    header p {
      margin: 0.2rem 0 0;
      font-size: 0.85rem;
      color: #9ca3af;
    }

    main {
      padding: 1rem;
      max-width: 900px;
      margin: 0 auto;
    }

    .card {
      background: radial-gradient(circle at top, #111827, #020617 55%);
      border-radius: 14px;
      padding: 0.9rem 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 18px 45px rgba(15,23,42,0.85);
      border: 1px solid #1f2937;
    }
    h2 {
      margin: 0 0 0.4rem;
      font-size: 1.05rem;
    }
    h3 {
      margin: 0.4rem 0 0.3rem;
      font-size: 0.95rem;
    }
    .pill {
      display: inline-block;
      padding: 0.15rem 0.55rem;
      border-radius: 999px;
      font-size: 0.75rem;
      background: rgba(37,99,235,0.08);
      color: #60a5fa;
      border: 1px solid rgba(37,99,235,0.5);
      margin-right: 0.3rem;
      margin-bottom: 0.2rem;
    }
    .kcal {
      color: #fbbf24;
      font-weight: 600;
    }
    .row {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 0.5rem;
    }
    input, select {
      padding: 0.45rem 0.55rem;
      font-size: 0.9rem;
      border-radius: 8px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      flex: 1;
      min-width: 120px;
    }
    button {
      padding: 0.45rem 0.7rem;
      font-size: 0.9rem;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      color: white;
      cursor: pointer;
      white-space: nowrap;
    }
    button.secondary {
      background: rgba(15,23,42,0.9);
      border: 1px solid #374151;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
      margin-top: 0.4rem;
    }
    th, td {
      padding: 0.3rem 0.25rem;
      border-bottom: 1px solid #111827;
      text-align: left;
    }
    th {
      color: #9ca3af;
      font-weight: 500;
    }

    details summary {
      cursor: pointer;
      list-style: none;
      font-weight: 600;
      margin-bottom: 0.2rem;
      color: #e5e7eb;
      font-size: 0.9rem;
    }
    details summary::-webkit-details-marker { display: none; }
    details summary::before {
      content: "▶ ";
      font-size: 0.7rem;
    }
    details[open] summary::before {
      content: "▼ ";
    }

    ul {
      margin: 0.2rem 0 0.4rem;
      padding-left: 1.1rem;
      font-size: 0.85rem;
      color: #d1d5db;
    }
    li { margin-bottom: 0.15rem; }

    .hint {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 0.3rem;
    }

    .meal-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(230px,1fr));
      gap: 0.6rem;
    }
    .meal-card {
      border-radius: 12px;
      border: 1px solid #111827;
      padding: 0.7rem 0.8rem;
      background: radial-gradient(circle at top left, #020617, #020617 40%, #020617);
    }
    .meal-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 0.15rem;
    }
    .meal-meta {
      font-size: 0.75rem;
      color: #9ca3af;
      margin-bottom: 0.2rem;
    }
    .meal-text {
      font-size: 0.8rem;
      color: #d1d5db;
    }

    @media (min-width: 700px) {
      header h1 { font-size: 1.4rem; }
    }
  </style>
</head>
<body>
<header>
  <h1>Ernährungsplan – Daniel</h1>
  <p>Gewicht • Tagesplan • Mittag (Mealprep) • Leichtes Abendessen</p>
</header>

<main>

  <!-- GEWICHT + DIAGRAMM -->
  <section class="card">
    <h2>Gewicht & Fortschritt</h2>
    <div class="row">
      <input type="date" id="weight-date">
      <input type="number" step="0.1" id="weight-value" placeholder="Gewicht in kg">
      <button id="weight-save-btn">Speichern</button>
    </div>
    <p class="hint">Am besten morgens nüchtern eintragen. Daten werden lokal auf deinem Gerät gespeichert.</p>
    <canvas id="weight-chart" style="width:100%;max-height:260px;margin-top:0.6rem;"></canvas>
    <table>
      <thead>
      <tr><th>Datum</th><th>Gewicht (kg)</th></tr>
      </thead>
      <tbody id="weight-table-body"></tbody>
    </table>
  </section>

  <!-- HEUTIGER TAG – AUTOMATISCHES MITTAG + ABEND -->
  <section class="card">
    <h2>Heutiger Tagesplan (automatisch)</h2>
    <p class="hint">Jeder Tag bekommt automatisch eine Kombination aus 1 warmem Mealprep-Mittag & 1 leichtem Abendessen.</p>
    <div id="today-info">
      <p><span class="pill">Datum</span> <span id="today-date-text"></span></p>
      <p><span class="pill">Mittag</span>
        <span id="today-lunch-name"></span> –
        <span class="kcal" id="today-lunch-kcal"></span>
      </p>
      <p><span class="pill">Abend</span>
        <span id="today-dinner-name"></span> –
        <span class="kcal" id="today-dinner-kcal"></span>
      </p>
      <p><b>Tages-Kalorien (nur Mittag+Abend):</b>
        <span class="kcal" id="today-total-kcal"></span> kcal
        <span class="hint">(Frühstück z.B. 350–450 kcal dazu rechnen)</span>
      </p>
      <button class="secondary" id="today-reroll-btn">Neue Kombination vorschlagen</button>
    </div>
  </section>

  <!-- MITTAG: 30 WARME MEALPREP-REZEPTE -->
  <section class="card">
    <h2>Warme Mittagsgerichte (Mealprep, ca. 500–750 kcal)</h2>
    <div class="meal-grid" id="lunch-list"></div>
  </section>

  <!-- ABEND: 30 LEICHTE REZEPTE -->
  <section class="card">
    <h2>Leichte Abendessen (ca. 300–500 kcal)</h2>
    <div class="meal-grid" id="dinner-list"></div>
  </section>

</main>

<script>
/* ---------- Datengrundlage: 30 Mittag + 30 Abend ---------- */

const lunchMeals = [
  { name: "Hähnchen-Reis-Bowl", kcal: 650,
    info: "Hähnchen, Reis, Brokkoli & Paprika, Olivenöl.",
    ingredients: ["200 g Hähnchenbrust", "70 g Reis (roh)", "200 g Brokkoli/Paprika", "1 TL Olivenöl"],
    steps: ["Reis kochen", "Hähnchen würzen & anbraten", "Gemüse garen", "Alles in Boxen füllen (Mealprep)"]
  },
  { name: "Thunfisch-Vollkornpasta", kcal: 600,
    info: "Vollkornnudeln mit Thunfisch-Tomatensauce.",
    ingredients: ["80 g Vollkornnudeln", "1 Dose Thunfisch in Wasser", "200 g gehackte Tomaten", "Mais/Paprika"],
    steps: ["Nudeln kochen", "Sauce aus Tomaten & Thunfisch kochen", "Mais/Paprika dazugeben", "Alles mischen"]
  },
  { name: "Chili con Carne", kcal: 620,
    info: "Mageres Hack, Bohnen, Mais, Tomaten.",
    ingredients: ["150 g mageres Hack", "1 Dose Kidneybohnen", "1 kleine Dose Mais", "200 g Tomaten aus der Dose"],
    steps: ["Hack anbraten", "Bohnen, Mais, Tomaten zugeben", "Mit Chili & Paprika würzen", "15–20 Min. köcheln"]
  },
  { name: "Lachs mit Kartoffeln & Gemüse", kcal: 680,
    info: "Lachsfilet aus dem Ofen mit Kartoffeln & Gemüse.",
    ingredients: ["150 g Lachs", "200 g Kartoffeln", "200 g Gemüse (z.B. Zucchini/Paprika)", "Zitrone"],
    steps: ["Kartoffeln vorkochen", "Lachs würzen & im Ofen backen", "Gemüse garen", "Alles in Dosen packen"]
  },
  { name: "Puten-Couscous-Pfanne", kcal: 600,
    info: "Pute, Couscous & buntes Gemüse.",
    ingredients: ["200 g Pute", "70 g Couscous", "200 g Gemüse", "Brühe"],
    steps: ["Couscous mit Brühe quellen lassen", "Pute & Gemüse anbraten", "Couscous untermischen"]
  },
  { name: "Hähnchen-Wrap-Bowl", kcal: 620,
    info: "Alle Wrap-Zutaten als Bowl mit Reis.",
    ingredients: ["200 g Hähnchen", "70 g Reis", "Salat, Tomaten, Mais", "Joghurt-Sauce"],
    steps: ["Reis kochen", "Hähnchen braten", "Gemüse schneiden", "Alles in einer Bowl anrichten"]
  },
  { name: "Mediterrane Reis-Gemüse-Pfanne", kcal: 580,
    info: "Reis mit Paprika, Zucchini, Oliven & Feta.",
    ingredients: ["70 g Reis", "250 g Gemüse", "20 g Feta"], steps: ["Reis kochen", "Gemüse anbraten", "Feta darüber bröseln"]
  },
  { name: "Hack-Gemüse-Pfanne", kcal: 620,
    info: "Mageres Hack mit viel Gemüse, dazu wenig Reis.",
    ingredients: ["150 g mageres Hack", "70 g Reis", "200 g Gemüse"], steps: ["Reis kochen", "Hack & Gemüse braten"]
  },
  { name: "Linsen-Bolo mit Vollkornnudeln", kcal: 600,
    info: "Rote Linsen in Tomatensauce, wie Bolognese.",
    ingredients: ["80 g Vollkornnudeln", "70 g rote Linsen", "Tomaten aus der Dose"], steps: ["Nudeln kochen", "Linsen in Tomatensauce garen"]
  },
  { name: "Kartoffel-Gemüse-Auflauf mit Pute", kcal: 650,
    info: "Schicht aus Kartoffeln, Pute & Gemüse, überbacken.",
    ingredients: ["200 g Kartoffeln", "150 g Pute", "200 g Gemüse"], steps: ["Alles in Auflaufform schichten", "Würzen & backen"]
  },
  { name: "Reis-Bohnen-Bowl (mexican style)", kcal: 590,
    info: "Reis, Bohnen, Mais, Salsa & etwas Käse.",
    ingredients: ["70 g Reis", "Bohnen", "Mais", "Tomaten", "etwas Reibekäse"], steps: ["Reis kochen", "Rest mischen"]
  },
  { name: "Hähnchen-Gyros mit Reis", kcal: 620,
    info: "Hähnchen mit Gyrosgewürz, dazu Reis & Salat.",
    ingredients: ["200 g Hähnchen", "70 g Reis", "Salat & Zwiebeln"], steps: ["Reis kochen", "Hähnchen würzen & braten"]
  },
  { name: "Süßkartoffel-Chili", kcal: 610,
    info: "Süßkartoffeln, Bohnen, Tomaten, leicht scharf.",
    ingredients: ["200 g Süßkartoffel", "Bohnen", "Tomaten"], steps: ["Süßkartoffelwürfel anbraten", "Rest zugeben & köcheln"]
  },
  { name: "Gnocchi-Gemüse-Pfanne (light)", kcal: 580,
    info: "Gnocchi mit viel Gemüse & Tomatensauce.",
    ingredients: ["200 g Gnocchi", "200 g Gemüse", "Tomaten"], steps: ["Gnocchi anbraten", "Gemüse & Sauce dazu"]
  },
  { name: "Asia-Reispfanne mit Huhn", kcal: 600,
    info: "Hähnchen, Asia-Gemüse, Sojasauce, Reis.",
    ingredients: ["200 g Hähnchen", "70 g Reis", "Asia-Gemüse"], steps: ["Reis kochen", "Hähnchen & Gemüse mit Sojasauce braten"]
  },
  { name: "Ofengemüse mit Kichererbsen & Feta", kcal: 620,
    info: "Blechgemüse, Kichererbsen & Feta, Mealprep-tauglich.",
    ingredients: ["300 g Gemüse", "1 Dose Kichererbsen", "40 g Feta"], steps: ["Alles aufs Blech", "Würzen & backen"]
  },
  { name: "Rindergeschnetzeltes + Reis", kcal: 680,
    info: "Mageres Rindfleisch mit Paprika & Reis.",
    ingredients: ["150 g mageres Rind", "70 g Reis", "Paprika/Zwiebel"], steps: ["Reis kochen", "Fleisch & Gemüse braten"]
  },
  { name: "Mediterrane Hähnchenpfanne", kcal: 610,
    info: "Hähnchen, Oliven, Tomaten, Feta.",
    ingredients: ["200 g Hähnchen", "Tomaten", "Oliven", "Feta"], steps: ["Alles in Pfanne braten/erwärmen"]
  },
  { name: "Curry-Hähnchen mit Reis", kcal: 630,
    info: "Currysauce mit Hähnchen & Gemüse, dazu Reis.",
    ingredients: ["200 g Hähnchen", "70 g Reis", "Gemüse"], steps: ["Reis kochen", "Hähnchen & Gemüse in Currysauce garen"]
  },
  { name: "Linsen-Curry mit Reis", kcal: 580,
    info: "Rote Linsen, Kokosmilch light, Curry, Reis.",
    ingredients: ["70 g Reis", "70 g Linsen", "etwas Kokosmilch light"], steps: ["Reis kochen", "Linsen-Curry kochen"]
  },
  { name: "Spaghetti mit Thunfisch-Tomaten-Sauce", kcal: 600,
    info: "Pasta, Thunfisch, Tomaten, Kräuter.",
    ingredients: ["80 g Spaghetti", "1 Dose Thunfisch", "Tomaten"], steps: ["Pasta kochen", "Sauce rühren"]
  },
  { name: "Hähnchen-Paprika-Topf", kcal: 610,
    info: "Hähnchenwürfel mit viel Paprika in Tomatensauce.",
    ingredients: ["200 g Hähnchen", "Paprika", "Tomaten"], steps: ["Alles in Topf garen"]
  },
  { name: "Protein-Spätzlepfanne", kcal: 650,
    info: "Protein-Spätzle (oder Vollkorn), Gemüse, Pute.",
    ingredients: ["200 g Protein-/Vollkornspätzle", "150 g Pute", "Gemüse"], steps: ["Spätzle & Pute & Gemüse braten"]
  },
  { name: "Bulgur-Gemüse-Bowl", kcal: 580,
    info: "Bulgur, Kichererbsen, Gemüse, Joghurt.",
    ingredients: ["70 g Bulgur", "200 g Gemüse", "Kichererbsen"], steps: ["Bulgur garen", "Rest mischen"]
  },
  { name: "Lachs-Reis-Bowl", kcal: 680,
    info: "Lachs, Reis, Gurke, Edamame oder Gemüse.",
    ingredients: ["150 g Lachs", "70 g Reis", "Gemüse"], steps: ["Reis & Lachs garen", "Bowl bauen"]
  },
  { name: "Hähnchen-Kartoffel-Pfanne", kcal: 650,
    info: "Gebratene Kartoffelwürfel mit Hähnchen & Gemüse.",
    ingredients: ["200 g Kartoffeln", "200 g Hähnchen", "Gemüse"], steps: ["Kartoffel & Hähnchen & Gemüse braten"]
  },
  { name: "Tomaten-Gemüse-Polenta", kcal: 600,
    info: "Polenta mit Tomaten-Gemüse-Sauce.",
    ingredients: ["Polenta", "Tomaten", "Gemüse"], steps: ["Polenta kochen", "Sauce kochen"]
  },
  { name: "Ratatouille mit Hähnchen & Reis", kcal: 620,
    info: "Ratatouille-Gemüse + Hähnchen + Reis.",
    ingredients: ["Ratatouille-Gemüse", "200 g Hähnchen", "70 g Reis"], steps: ["Reis kochen", "Rest in Pfanne garen"]
  },
  { name: "Spicy Reis mit Tofu/Chicken", kcal: 600,
    info: "Reis mit Tofu oder Hähnchen & scharfem Gemüse.",
    ingredients: ["70 g Reis", "200 g Tofu/Hähnchen", "Gemüse"], steps: ["Reis kochen", "Rest scharf anbraten"]
  },
  { name: "Ofenblech „alles drauf“", kcal: 650,
    info: "Kartoffeln, Gemüse, Hähnchen gemischt auf dem Blech.",
    ingredients: ["Kartoffeln", "Hähnchen", "Gemüse"], steps: ["Alles würfeln, würzen, aufs Blech & backen"]
  }
];

const dinnerMeals = [
  { name: "Großer gemischter Salat + Thunfisch", kcal: 350,
    info: "Salatmix, Tomate, Gurke, Mais, 1 Dose Thunfisch.",
    ingredients: ["Salat", "Tomaten", "Gurke", "Mais", "1 Dose Thunfisch"],
    steps: ["Alles schneiden", "mit Dressing mischen", "Thunfisch darauf"]
  },
  { name: "Skyr + Obst + Nüsse", kcal: 350,
    info: "Skyr/Quark mit Apfel oder Beeren & 10 g Nüsse.",
    ingredients: ["250 g Skyr", "Obst", "10 g Nüsse"], steps: ["Alles in Schale, umrühren"]
  },
  { name: "Gemüseomelett", kcal: 400,
    info: "3 Eier, Gemüse, wenig Öl.",
    ingredients: ["3 Eier", "Gemüse nach Wahl"], steps: ["Gemüse andünsten", "Eier dazu, stocken lassen"]
  },
  { name: "Hüttenkäse + Gemüsesticks", kcal: 320,
    info: "Hüttenkäse als Dip, Karotten/Gurken/ Paprika.",
    ingredients: ["200 g Hüttenkäse", "Gemüse"], steps: ["Gemüse schneiden, dippen"]
  },
  { name: "Brot + Putenbrust + Gemüse", kcal: 400,
    info: "2 Scheiben Vollkornbrot, Putenaufschnitt, Gurke/Tomate.",
    ingredients: ["2 Scheiben Brot", "Pute", "Gemüse"], steps: ["Belegen & mit Gemüse essen"]
  },
  { name: "Rührei + Salat", kcal: 380,
    info: "3 Eier als Rührei + kleiner Salat.",
    ingredients: ["3 Eier", "Salat"], steps: ["Rührei braten", "Salat anrichten"]
  },
  { name: "Tomaten-Mozzarella light", kcal: 350,
    info: "Tomaten, light Mozzarella, Balsamico.",
    ingredients: ["Tomaten", "Mozzarella light"], steps: ["Scheiben schneiden, anrichten"]
  },
  { name: "Thunfisch-Quark-Dip + Rohkost", kcal: 330,
    info: "Magerquark + Thunfisch + Gewürze, Gemüse dazu.",
    ingredients: ["Magerquark", "Thunfisch", "Gemüse"], steps: ["Dip rühren, mit Gemüse essen"]
  },
  { name: "Skyr mit Zimt & Apfel", kcal: 320,
    info: "Skyr + 1 Apfel + Zimt.",
    ingredients: ["250 g Skyr", "1 Apfel", "Zimt"], steps: ["Apfel schneiden, alles mischen"]
  },
  { name: "Protein-Joghurt + Beeren", kcal: 300,
    info: "Protein-Joghurt + Beeren (frisch oder TK).",
    ingredients: ["1 Becher Protein-Joghurt", "Beeren"], steps: ["Beeren dazugeben, fertig"]
  },
  { name: "Kleiner Lachs-Salat", kcal: 420,
    info: "Salat mit 80–100 g Lachs (geräuchert oder gebraten).",
    ingredients: ["Salat", "Lachs", "Gemüse"], steps: ["Salat bauen, Lachs oben drauf"]
  },
  { name: "Eier mit Tomaten & Spinat", kcal: 380,
    info: "3 Eier mit Tomaten & Spinat in der Pfanne.",
    ingredients: ["3 Eier", "Tomaten", "Spinat"], steps: ["Gemüse andünsten, Eier dazu"]
  },
  { name: "Greek Bowl light", kcal: 400,
    info: "Tomaten, Gurke, Oliven, wenig Feta, Joghurt-Dressing.",
    ingredients: ["Tomate", "Gurke", "Oliven", "Feta"], steps: ["Alles klein schneiden, mischen"]
  },
  { name: "Hüttenkäse + Ananas", kcal: 320,
    info: "Hüttenkäse mit frischer oder Dosen-Ananas (eigener Saft).",
    ingredients: ["200 g Hüttenkäse", "Ananas"], steps: ["Ananasstücke mit Hüttenkäse mischen"]
  },
  { name: "Gemüsepfanne mit Ei", kcal: 380,
    info: "Viel Gemüse, oben 2 Eier darüber.",
    ingredients: ["Gemüse", "2 Eier"], steps: ["Gemüse braten, Eier darüber stocken lassen"]
  },
  { name: "Wrap light (Thunfisch/ Pute)", kcal: 400,
    info: "1 Vollkornwrap, viel Salat, etwas Thunfisch/Pute.",
    ingredients: ["Wrap", "Salat", "Thunfisch/Pute"], steps: ["Alles einrollen"]
  },
  { name: "Caprese-Salat + 1 Scheibe Brot", kcal: 410,
    info: "Tomate, Mozzarella, Basilikum + 1 Scheibe Brot.",
    ingredients: ["Tomate", "Mozzarella", "Basilikum", "Brot"], steps: ["Salat, dazu Brot"]
  },
  { name: "Joghurt + Hafer + Beeren (klein)", kcal: 350,
    info: "Joghurt + 30 g Hafer + Beeren.",
    ingredients: ["150–200 g Joghurt", "30 g Hafer", "Beeren"], steps: ["Alles vermischen"]
  },
  { name: "Salat + gekochte Eier", kcal: 360,
    info: "Salat mit 2 gekochten Eiern.",
    ingredients: ["Salat", "2 Eier"], steps: ["Eier kochen, schneiden, auf Salat"]
  },
  { name: "Gemüsesuppe light", kcal: 300,
    info: "Klare Brühe mit viel Gemüse.",
    ingredients: ["Brühe", "Gemüse"], steps: ["Gemüse in Brühe kochen"]
  },
  { name: "Skyr + Banane + Erdnussmus (1 TL)", kcal: 390,
    info: "Skyr mit Banane & 1 TL Erdnussmus.",
    ingredients: ["250 g Skyr", "1 Banane", "1 TL Erdnussmus"], steps: ["Alles mischen"]
  },
  { name: "Rohkostteller + Hummus", kcal: 350,
    info: "Karotte, Gurke, Paprika mit 50–70 g Hummus.",
    ingredients: ["Gemüse", "Hummus"], steps: ["Gemüse schneiden, dippen"]
  },
  { name: "Mini-Bowl mit Reis & Gemüse", kcal: 400,
    info: "Kleine Portion Reis + Gemüse + etwas Protein.",
    ingredients: ["50 g Reis", "Gemüse", "kleine Proteinquelle"], steps: ["Alles in Schüssel"]
  },
  { name: "Tomaten-Hülsenfrucht-Salat", kcal: 380,
    info: "Tomaten, Kichererbsen/Bohnen, Zwiebel, Petersilie.",
    ingredients: ["Tomaten", "Kichererbsen/Bohnen", "Zwiebel"], steps: ["Mischen & würzen"]
  },
  { name: "Protein-Pudding + Beeren", kcal: 320,
    info: "Fertiger Protein-Pudding mit Beeren oder Obst.",
    ingredients: ["Protein-Pudding", "Obst/Beeren"], steps: ["Obst drauf, fertig"]
  },
  { name: "Taco-Salat (ohne Wrap)", kcal: 420,
    info: "Salat, Hackreste/Thunfisch, Mais, Bohnen.",
    ingredients: ["Salat", "Proteinreste", "Mais", "Bohnen"], steps: ["Alles in Schale mischen"]
  },
  { name: "Ofengemüse klein + Feta", kcal: 400,
    info: "Kleine Portion Ofengemüse mit 30–40 g Feta.",
    ingredients: ["Gemüse", "Feta"], steps: ["Auf Blech backen"]
  },
  { name: "Quark + Beeren + Zimt", kcal: 330,
    info: "Magerquark, Beeren, Zimt.",
    ingredients: ["250 g Quark", "Beeren", "Zimt"], steps: ["Mischen & genießen"]
  },
  { name: "Salat + Räucherlachs", kcal: 420,
    info: "Gemischter Salat mit 60–80 g Räucherlachs.",
    ingredients: ["Salat", "Räucherlachs"], steps: ["Anrichten"]
  },
  { name: "Eierwrap (Omelett eingerollt)", kcal: 380,
    info: "Dünnes Omelett als Wrap mit Gemüse gefüllt.",
    ingredients: ["2–3 Eier", "Gemüse"], steps: ["Omelett braten, füllen, einrollen"]
  }
];

/* ---------- Heutiger Tagesplan (auto) ---------- */

function getTodayKey() {
  const today = new Date();
  return today.toISOString().slice(0,10);
}

// index 0–29 für Mittag/Abend, basierend auf Tageszahl
function getDayIndex(dateStr) {
  const d = new Date(dateStr);
  const start = new Date(d.getFullYear(), 0, 1);
  const diff = Math.floor((d - start) / 86400000); // Tage seit Jahresanfang
  return diff % 30;
}

const todayDateText = document.getElementById("today-date-text");
const todayLunchName = document.getElementById("today-lunch-name");
const todayLunchKcal = document.getElementById("today-lunch-kcal");
const todayDinnerName = document.getElementById("today-dinner-name");
const todayDinnerKcal = document.getElementById("today-dinner-kcal");
const todayTotalKcal = document.getElementById("today-total-kcal");
const todayRerollBtn = document.getElementById("today-reroll-btn");

function renderTodayPlan(optionalRandom) {
  const todayKey = getTodayKey();
  todayDateText.textContent = todayKey;

  let idx = getDayIndex(todayKey);
  if (optionalRandom === true) {
    idx = Math.floor(Math.random() * 30);
  }

  const lunch = lunchMeals[idx];
  const dinner = dinnerMeals[idx];

  todayLunchName.textContent = lunch.name;
  todayLunchKcal.textContent = lunch.kcal + " kcal";
  todayDinnerName.textContent = dinner.name;
  todayDinnerKcal.textContent = dinner.kcal + " kcal";
  todayTotalKcal.textContent = lunch.kcal + dinner.kcal;
}

todayRerollBtn.addEventListener("click", () => renderTodayPlan(true));

/* ---------- Anzeige aller Rezepte ---------- */

function createMealCard(meal) {
  const div = document.createElement("div");
  div.className = "meal-card";
  const ing = (meal.ingredients || []).map(x => `<li>${x}</li>`).join("");
  const steps = (meal.steps || []).map(x => `<li>${x}</li>`).join("");
  div.innerHTML = `
    <div class="meal-title">${meal.name}</div>
    <div class="meal-meta">${meal.kcal ? `~${meal.kcal} kcal` : ""}</div>
    <div class="meal-text">${meal.info || ""}</div>
    <details style="margin-top:0.25rem;">
      <summary>Details</summary>
      <p><b>Zutaten (Basis):</b></p>
      <ul>${ing}</ul>
      <p><b>Zubereitung (Kurz):</b></p>
      <ul>${steps}</ul>
    </details>
  `;
  return div;
}

function renderMealLists() {
  const lunchContainer = document.getElementById("lunch-list");
  const dinnerContainer = document.getElementById("dinner-list");
  lunchContainer.innerHTML = "";
  dinnerContainer.innerHTML = "";
  lunchMeals.forEach(m => lunchContainer.appendChild(createMealCard(m)));
  dinnerMeals.forEach(m => dinnerContainer.appendChild(createMealCard(m)));
}

/* ---------- Gewicht + Diagramm ---------- */

let weightChart = null;

function loadWeights() {
  try {
    return JSON.parse(localStorage.getItem("weights_daniel") || "[]");
  } catch {
    return [];
  }
}
function saveWeights(data) {
  localStorage.setItem("weights_daniel", JSON.stringify(data));
}
function renderWeightTable() {
  const tbody = document.getElementById("weight-table-body");
  const data = loadWeights().sort((a,b) => a.date.localeCompare(b.date));
  tbody.innerHTML = data
    .map(e => `<tr><td>${e.date}</td><td>${parseFloat(e.weight).toFixed(1)}</td></tr>`)
    .join("");
}
function renderWeightChart() {
  const ctx = document.getElementById("weight-chart").getContext("2d");
  const data = loadWeights().sort((a,b) => a.date.localeCompare(b.date));
  const labels = data.map(e => e.date.slice(5)); // MM-TT
  const values = data.map(e => e.weight);

  if (weightChart) {
    weightChart.destroy();
  }
  weightChart = new Chart(ctx, {
    type: "line",
    data: {
      labels,
      datasets: [{
        label: "Gewicht (kg)",
        data: values,
        tension: 0.3,
        borderColor: "#60a5fa",
        backgroundColor: "rgba(96,165,250,0.15)",
        fill: true,
        borderWidth: 2,
        pointRadius: 3,
        pointBackgroundColor: "#fbbf24"
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false }
      },
      scales: {
        x: {
          ticks: { color: "#9ca3af", font: { size: 10 } },
          grid: { color: "#111827" }
        },
        y: {
          ticks: { color: "#9ca3af", font: { size: 10 } },
          grid: { color: "#111827" }
        }
      }
    }
  });
}

const weightDateInput = document.getElementById("weight-date");
const weightValueInput = document.getElementById("weight-value");
const weightSaveBtn = document.getElementById("weight-save-btn");

function initWeightForm() {
  if (!weightDateInput.value) {
    weightDateInput.value = new Date().toISOString().slice(0,10);
  }
  weightSaveBtn.addEventListener("click", () => {
    const date = weightDateInput.value;
    const w = parseFloat((weightValueInput.value || "").replace(",", "."));
    if (!date || isNaN(w)) {
      alert("Bitte Datum und Gewicht eingeben.");
      return;
    }
    const data = loadWeights();
    const existing = data.find(d => d.date === date);
    if (existing) existing.weight = w;
    else data.push({ date, weight: w });
    saveWeights(data);
    renderWeightTable();
    renderWeightChart();
    weightValueInput.value = "";
  });
}

/* ---------- Init ---------- */

renderTodayPlan(false);
renderMealLists();
initWeightForm();
renderWeightTable();
renderWeightChart();
</script>
</body>
</html>